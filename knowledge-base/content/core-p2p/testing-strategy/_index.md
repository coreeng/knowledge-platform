+++
title = "Testing Strategy"
date = 2022-12-26T19:32:10+02:00
weight = 3
chapter = false
+++
## Testing Strategy 

These are the types of tests that should be included as part of any P2P. They are the key enablers for Continuous Delivery. 

Common terminology assists in communicating with each other and to give a consistent message to customers.

Our testing strategy is heavily focussed on enabling Continuous Deployment and decoupling teams. 

## Stubbing
We use the term stubbing to mean removing testing dependencies on other services and teams. It is done at the protocol level e.g. HTTP, TCP, UDP.

For both functional and non-functional tests we recommend stubbing out all components not in the team’s immediate control so a service can be validated without depending on another team.

We use tools such as [WireMock - flexible, open source API mocking](https://wiremock.org/) to do the stubbing.

## Deployed vs non-deployed tests

The main difference between ‘Deployed’ and ‘Non-Deployed’ tests is where the service is running.   
We often use the phrase ‘Localised Tests’ interchangeably with ‘non-deployed’ tests.   

Non-Deployed tests are tests that can also be run on an engineers local workstation with little to no setup.   
Deployed tests, require deploying the service into a ‘production-like’ but non necessarily ‘production-scale’ environment, 
and then executing your tests remotely as a real-world client of your service would interact.   

Doing deployed tests shifts us from a mentality of artifact delivery (validating just the code and some basic config), to service delivery (validating everything required to start a production service including ingress, network policies, deployment tooling and other platform level configurations).

Running tests against a deployed environment should be shifted left as much as possible, ideally as part of PR validation. That way every part of application configuration is tested.

Often functional tests can be run in a deployed and non-deployed way.

## Environment specific configuration
We aim to reduce the amount of environment specific configuration as much as possible so that once a service is verified in one deployed environment there is high confidence it will work in the next environment.

## Types of Testing

| Test                                                                                                                                                                                                                                                                                                                  | Description                                                                                                                                                                                                                                                                                                                                                                                                                      | Sub-Category                                                                                                                                                                                                                                                                                      | Setup                                                                                                                                                                                                                                                                                                                                                  | Purpose                                                                                                                                                                                                                                            | Priority                                                                                                                                                                                                                     | Pre-Requisites                                                                                                                                                                                                                                   |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [Unit Testing](/core-p2p/testing-strategy/unit-testing)                                                                                                                                                                                                                                          || Unit                                                                                                                                                                                                                                                                                                                                                                                                                             | {{< list "the application is not packaged and deployed yet" >}}                                                                                                                                                                                                                                   | Testing specific functionality and algorithms in the application. Helps designing the code in a decoupled way.                                                                                                                                                                                                                                         | 2                                                                                                                                                                                                                                                  |                                                                                                                                                                                                                              |
| [Stubbed Functional Testing](/core-p2p/testing-strategy/functional-testing)                                                                                                                                                                                                                      || Stubbed Functional Test                                                                                                                                                                                                                                                                                                                                                                                                          | {{< list "the app artifact is deployed" "the third party dependencies are stubbed but the dependencies we have control of are real (e.g: Databases, caches, other services in our control)." "The third party dependencies are replaced with deployed stubs to emulate third party behaviour" >}} | Tests the overall e2e journeys with stubbed dependencies. Can test scenarios that can’t be simulated in integration, like receiving different errors from the downstream systems.                                                                                                                                                                      | 1                                                                                                                                                                                                                                                  | Here we need to have the business requirements for what the expected behaviour of the application from the user perspective. BDD is a suited technique here for illustrating the business requirements in a readable format. |
|| {{< list "Can shift left the running of functional tests to be run locally and in PR validation if deployed tests can’t be done from branches" "At times it is hard to do deployed tests due to the lack of light weight environment e.g. when using serverless and a cloud account/project is the 'environment'" >}} | Non-Deployed Stubbed Functional Test                                                                                                                                                                                                                                                                                                                                                                                             | {{< list "This does not require the application to be deployed" >}}                                                                                                                                                                                                                               | Ensures application behaviour via a test client for example, so we don’t actually need to deploy the app. A lot of frameworks provide a test client for this purpose.                                                                                                                                                                                  |||
| Integration Testing                                                                                                                                                                                                                                                                                                   | {{< list "Integration is a very over loaded term when it comes to testing." "We think large integrated environments that need “booked time” to do testing are a huge blocker for CD." "Picking the right level of integration is key e.g. the services that are in a team’s/department’s control and stub out other areas of the organisation." "Part of this is to move companies away from large integrated environments." >}} | Integration                                                                                                                                                                                                                                                                                       | {{< list "Runs against a deployed application with some real third party dependencies"" Needs to be careful with the load it puts on downstream systems  - some external test application have limited TPS" >}}                                                                                                                                        | {{< list "Ensures real connectivity to test dependencies - non-stubbed." "A subset of behavioural test that validates some of the data and setup assumption but is not exhaustive. Tests critical path scenarios (critical for the business)." >}} | 3                                                                                                                                                                                                                            | {{< list "Test systems we can test against. " "Data requirements (e.g specific users we need to test to)." >}}                                                                                                                                   |
| [Stubbed NFT](/core-p2p/testing-strategy/non-functional-testing)                                                                                                                                                                                                                                 | Fast feedback quick NFT                                                                                                                                                                                                                                                                                                                                                                                                          | Short Peak Testing                                                                                                                                                                                                                                                                                | {{< list "The third party dependencies are replaced with deployed stubs to emulate third party behaviour" "Testing NFRs during shot period of time - fast feedback pipeline" "Dependencies are stubbed" "Should be prod-like → same replicas, connected to a similar DB hardware, DB should be the same size as prod or what it is expected to be" >}} | {{< list "Ensures that we can achieve the NFRs." "Minimal insurance that the application is properly scaled to handle the NFRs. Can be done at the same time as it’s being redeployed." "This helps scale the application when going to prod" >}}  | 5                                                                                                                                                                                                                            | {{< list "Here we need all the NFRs for the application. For example if the we test APIs we need p99s, max response time." "We also need some NFRs for the third party systems that we depend on so that we know how to configure the stub." >}} |
| Extended Stubbed NFT                                                                                                                                                                                                                                                                                                  | Longer non functional testing not part of PR pipeline                                                                                                                                                                                                                                                                                                                                                                            | Soak testing                                                                                                                                                                                                                                                                                      | {{< list "Running load tests and different TPS during long periods of time (>2h)" "Here we should incorporate peak tests as well with the frequency required by the app" >}}                                                                                                                                                                           | {{< list "Ensures the performance doesn’t degrade over time - great to catch memory leaks" >}}                                                                                                                                                     | 7                                                                                                                                                                                                                            | We know to know how much the max load will be and how frequent we should expect it.                                                                                                                                                              |
||| Re-deployment Testing                                                                                                                                                                                                                                                                                                 | {{< list "Run load tests and redeploy mid run the application" "Moving nodes while under load testing" >}}                                                                                                                                                                                                                                                                                                                       | Ensures that there are no errors during redeploying while under load. The application can also be moved from one node to another, which would cause a similar behaviour so this is a test that all applications need regardless of the deployment strategy                                        | 4                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                                                                                                                    |
||| Resilience Testing                                                                                                                                                                                                                                                                                                    | {{< list "Starting with dependencies down" "Handle dependencies going down or being slow" "Handle load while dependencies down and gracefully failing" "Circuit breakers are setup if having circuit breakers is a requirement." >}}                                                                                                                                                                                             | {{< list "Ensures that in the worst case scenario the application will not die and will gracefully send an error back to the user with the reason the request has failed" "If circuit breakers are in place, it focuses on validating the throttling model and graceful failure." >}}             | 6                                                                                                                                                                                                                                                                                                                                                      |

 
